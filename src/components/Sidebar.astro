---
/**
 * Custom Sidebar Component
 * Extends Starlight's default sidebar with expand/collapse all buttons
 */
import type { Props } from '@astrojs/starlight/props';
import Default from '@astrojs/starlight/components/Sidebar.astro';
---

<div class="sidebar-controls">
  <button type="button" class="sidebar-control-btn" id="expand-all" title="Expand all sections">
    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="m3 8 4-4 4 4"/>
      <path d="M7 4v16"/>
      <path d="M11 12h4"/>
      <path d="M11 16h7"/>
      <path d="M11 20h10"/>
    </svg>
    <span>Expand</span>
  </button>
  <button type="button" class="sidebar-control-btn" id="collapse-all" title="Collapse all sections">
    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="m3 16 4 4 4-4"/>
      <path d="M7 20V4"/>
      <path d="M11 4h10"/>
      <path d="M11 8h7"/>
      <path d="M11 12h4"/>
    </svg>
    <span>Collapse</span>
  </button>
</div>

<Default {...Astro.props}><slot /></Default>

<script>
  function initSidebarControls() {
    const expandBtn = document.getElementById('expand-all');
    const collapseBtn = document.getElementById('collapse-all');

    if (!expandBtn || !collapseBtn) return;

    expandBtn.addEventListener('click', () => {
      // Find all sidebar group details elements
      const groups = document.querySelectorAll('.sidebar-pane details, nav[aria-label="Main"] details');
      groups.forEach((group) => {
        group.setAttribute('open', '');
      });

      // Also handle Starlight's specific sidebar structure
      const starlightGroups = document.querySelectorAll('[data-sl-sidebar-group]');
      starlightGroups.forEach((group) => {
        const details = group.querySelector('details');
        if (details) details.setAttribute('open', '');
      });
    });

    collapseBtn.addEventListener('click', () => {
      // Find all sidebar group details elements
      const groups = document.querySelectorAll('.sidebar-pane details, nav[aria-label="Main"] details');
      groups.forEach((group) => {
        group.removeAttribute('open');
      });

      // Also handle Starlight's specific sidebar structure
      const starlightGroups = document.querySelectorAll('[data-sl-sidebar-group]');
      starlightGroups.forEach((group) => {
        const details = group.querySelector('details');
        if (details) details.removeAttribute('open');
      });
    });
  }

  // Run on initial load
  initSidebarControls();

  // Re-run after Astro page transitions
  document.addEventListener('astro:page-load', initSidebarControls);
</script>

<style>
  .sidebar-controls {
    display: flex;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    margin-bottom: 0.5rem;
    border-bottom: 1px solid var(--sl-color-hairline-light);
  }

  .sidebar-control-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.375rem 0.625rem;
    background: transparent;
    border: 1px solid var(--sl-color-hairline);
    border-radius: 6px;
    color: var(--sl-color-gray-3);
    font-size: 0.75rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.15s ease;
  }

  .sidebar-control-btn:hover {
    background: rgba(99, 91, 255, 0.08);
    border-color: var(--sl-color-accent);
    color: var(--sl-color-accent);
  }

  .sidebar-control-btn:active {
    transform: scale(0.98);
  }

  .sidebar-control-btn svg {
    flex-shrink: 0;
  }
</style>
